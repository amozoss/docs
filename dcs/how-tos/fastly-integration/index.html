<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Fastly's CDN platform allows users to distribute their content among the Fastly edge cloud service. You can easily configure your buckets on Storj as a source of content and integrate them with Fastly"><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="Fastly Integration"><meta property="og:description" content="Fastly's CDN platform allows users to distribute their content among the Fastly edge cloud service. You can easily configure your buckets on Storj as a source of content and integrate them with Fastly"><meta property="og:type" content="article"><meta property="og:url" content="/dcs/how-tos/fastly-integration/"><meta property="article:section" content="dcs"><title>Fastly Integration | Storj Docs</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.f89e84d24aa67a9627cfb7a3b446b3b062a451eebceb8d5f060601553c0a6cfb.css><script defer src=/flexsearch.min.js></script>
<script defer src=/en.search.min.afc156b59ccdf08ee689010e2667621d6ac7b00f30a969882371f26dd69b9b61.js></script>
<script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js></script>
<link rel=subresource href=/fonts/Inter-roman.var.woff2><link rel=subresource href=/fonts/Inter-italic.var.woff2></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Storj Docs</span></a></h2><div class=book-search><input type=text id=book-search-input data-filter=/dcs/ placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul class=book-first-sections><li class=active><a href=/dcs/>DCS</a></li><li><a href=/node/>Node Operator</a></li></ul><ul><li class=book-section-flat><span>Decentralized Cloud Storage</span><ul><li><a href=/dcs/storage/considerations/>Product Overview</a></li></ul></li><li class=book-section-flat><span>Downloads</span><ul><li><a href=/dcs/downloads/download-uplink-cli/>Download Uplink CLI</a></li><li><a href=/dcs/downloads/download-self-hosted-s3-compatible-gateway/>Download Self-hosted S3 Compatible Gateway</a></li><li><a href=/dcs/downloads/download-storj-client-libraries/>Download Storj Client Libraries</a></li></ul></li><li class=book-section-flat><span>Getting Started</span><ul><li><a href=/dcs/getting-started/quickstart-guide/>Quickstart Guide</a></li><li><a href=/dcs/getting-started/quickstart-objectbrowser/>Quickstart - Object Browser</a></li><li><input type=checkbox id=section-8a2bc98c91c60155c8bcc6967e5b3cf7 class=toggle>
<label for=section-8a2bc98c91c60155c8bcc6967e5b3cf7 class="flex justify-between"><a href=/dcs/getting-started/gateway-mt/>Quickstart - AWS CLI and Hosted Gateway MT</a></label><ul><li><a href=/dcs/getting-started/gateway-mt/aws-cli-advanced-options/>AWS CLI Advanced Options</a></li></ul></li><li><a href=/dcs/getting-started/quickstart-aws-sdk-and-hosted-gateway-mt/>Quickstart - AWS SDK and Hosted Gateway MT</a></li><li><input type=checkbox id=section-eb51eff27101399663fec0a5feb790b7 class=toggle>
<label for=section-eb51eff27101399663fec0a5feb790b7 class="flex justify-between"><a href=/dcs/getting-started/quickstart-uplink-cli/>Quickstart - Uplink CLI</a></label><ul><li><a href=/dcs/getting-started/quickstart-uplink-cli/prerequisites/>Prerequisites</a></li><li><input type=checkbox id=section-1cc3e1bb03e2e308966123bb1cc84dfc class=toggle>
<label for=section-1cc3e1bb03e2e308966123bb1cc84dfc class="flex justify-between"><a href=/dcs/getting-started/quickstart-uplink-cli/uploading-your-first-object/>Uploading Your First Object CLI</a></label><ul><li><a href=/dcs/getting-started/quickstart-uplink-cli/uploading-your-first-object/create-first-access-grant/>Create an Access Grant</a></li><li><a href=/dcs/getting-started/quickstart-uplink-cli/uploading-your-first-object/set-up-uplink-cli/>Set Up Uplink CLI with Access Grant</a></li><li><a href=/dcs/getting-started/quickstart-uplink-cli/uploading-your-first-object/create-a-bucket/>Create a Bucket</a></li><li><a href=/dcs/getting-started/quickstart-uplink-cli/uploading-your-first-object/upload-an-object/>Upload an Object</a></li><li><a href=/dcs/getting-started/quickstart-uplink-cli/uploading-your-first-object/view-distribution-of-an-object/>View Distribution of an Object</a></li></ul></li><li><input type=checkbox id=section-ef98e9c48f14a1e6e3291b7ffdd021df class=toggle>
<label for=section-ef98e9c48f14a1e6e3291b7ffdd021df class="flex justify-between"><a href=/dcs/getting-started/quickstart-uplink-cli/interacting-with-your-first-object/>Interacting With Your First Object CLI</a></label><ul><li><a href=/dcs/getting-started/quickstart-uplink-cli/interacting-with-your-first-object/list-an-object/>List an Object</a></li><li><a href=/dcs/getting-started/quickstart-uplink-cli/interacting-with-your-first-object/download-an-object/>Download an Object</a></li><li><a href=/dcs/getting-started/quickstart-uplink-cli/interacting-with-your-first-object/delete-an-object/>Delete an Object</a></li></ul></li><li><input type=checkbox id=section-583035221fd089be3bccd9566e3d01dd class=toggle>
<label for=section-583035221fd089be3bccd9566e3d01dd class="flex justify-between"><a href=/dcs/getting-started/quickstart-uplink-cli/sharing-your-first-object/>Sharing Your First Object</a></label><ul><li><a href=/dcs/getting-started/quickstart-uplink-cli/sharing-your-first-object/prerequisites/>Prerequisites</a></li><li><a href=/dcs/getting-started/quickstart-uplink-cli/sharing-your-first-object/generate-access/>Create an Access to an Object</a></li><li><a href=/dcs/getting-started/quickstart-uplink-cli/sharing-your-first-object/import-access/>Import an Access to an Object</a></li><li><a href=/dcs/getting-started/quickstart-uplink-cli/sharing-your-first-object/revoke-an-access-to-an-object/>Revoke an Access to an Object</a></li></ul></li><li><input type=checkbox id=section-5272dcaf3a9682609c7d3fdd368cf961 class=toggle>
<label for=section-5272dcaf3a9682609c7d3fdd368cf961 class="flex justify-between"><a href=/dcs/getting-started/quickstart-uplink-cli/generate-access-grants-and-tokens/>Advanced Usage</a></label><ul><li><a href=/dcs/getting-started/quickstart-uplink-cli/generate-access-grants-and-tokens/generate-a-token/>Create Access Grant in CLI</a></li></ul></li></ul></li><li><input type=checkbox id=section-e035376383ed4301f1acc99452a9495f class=toggle>
<label for=section-e035376383ed4301f1acc99452a9495f class="flex justify-between"><a href=/dcs/getting-started/satellite-developer-account/>Quickstart - Satellite Admin Console</a></label><ul><li><a href=/dcs/getting-started/satellite-developer-account/creating-your-account/>Creating Your Account</a></li><li><a href=/dcs/getting-started/satellite-developer-account/manage-projects/>Manage Projects</a></li><li><a href=/dcs/getting-started/satellite-developer-account/dashboard/>Dashboard</a></li><li><a href=/dcs/getting-started/satellite-developer-account/objects/>Buckets</a></li><li><a href=/dcs/getting-started/satellite-developer-account/access-grants/>Access</a></li><li><a href=/dcs/getting-started/satellite-developer-account/users/>Users</a></li><li><a href=/dcs/getting-started/satellite-developer-account/billing/>Billing</a></li><li><a href=/dcs/getting-started/satellite-developer-account/resources/>Resources</a></li><li><a href=/dcs/getting-started/satellite-developer-account/quick-start/>Quick Start</a></li><li><a href=/dcs/getting-started/satellite-developer-account/my-account/>My Account</a></li></ul></li></ul></li><li class=book-section-flat><span>SDK & Reference</span><ul><li><input type=checkbox id=section-e71eaa406f51abd64ce74a83dbe5dd13 class=toggle>
<label for=section-e71eaa406f51abd64ce74a83dbe5dd13 class="flex justify-between"><a href=/dcs/api-reference/s3-compatible-gateway/>Storj-hosted S3 Compatible Gateway</a></label><ul><li><input type=checkbox id=section-5fc59ab320b4677ae3ebd53fe7b10db5 class=toggle>
<label for=section-5fc59ab320b4677ae3ebd53fe7b10db5 class="flex justify-between"><a href=/dcs/api-reference/s3-compatible-gateway/multipart-upload/>Multipart Upload</a></label><ul><li><a href=/dcs/api-reference/s3-compatible-gateway/multipart-upload/multipart-part-size/>Multipart Part Size</a></li></ul></li><li><a href=/dcs/api-reference/s3-compatible-gateway/using-presigned-urls/>Using presigned URLs</a></li><li><a href=/dcs/api-reference/s3-compatible-gateway/supported-s3-commands/>Supported S3 Commands</a></li></ul></li><li><input type=checkbox id=section-e534a50d47604ebc17cdb3d09a7bbe5c class=toggle>
<label for=section-e534a50d47604ebc17cdb3d09a7bbe5c class="flex justify-between"><a href=/dcs/api-reference/uplink-cli/>Uplink CLI</a></label><ul><li><input type=checkbox id=section-ab2e55a365604a01b5cad7151a01b544 class=toggle>
<label for=section-ab2e55a365604a01b5cad7151a01b544 class="flex justify-between"><a href=/dcs/api-reference/uplink-cli/access-command/>access</a></label><ul><li><a href=/dcs/api-reference/uplink-cli/access-command/access-inspect-command/>access inspect</a></li><li><a href=/dcs/api-reference/uplink-cli/access-command/access-list-command/>access list</a></li><li><a href=/dcs/api-reference/uplink-cli/access-command/access-register/>access register</a></li></ul></li><li><a href=/dcs/api-reference/uplink-cli/cp-command/>cp</a></li><li><a href=/dcs/api-reference/uplink-cli/import-command/>import</a></li><li><a href=/dcs/api-reference/uplink-cli/ls-command/>ls</a></li><li><a href=/dcs/api-reference/uplink-cli/uplink-mb-command/>mb</a></li><li><input type=checkbox id=section-12823ba9c45a10b81b0eaecb4dfc8ebb class=toggle>
<label for=section-12823ba9c45a10b81b0eaecb4dfc8ebb class="flex justify-between"><a href=/dcs/api-reference/uplink-cli/meta-command/>meta</a></label><ul><li><a href=/dcs/api-reference/uplink-cli/meta-command/meta-get-command/>meta get</a></li></ul></li><li><a href=/dcs/api-reference/uplink-cli/mv/>mv</a></li><li><a href=/dcs/api-reference/uplink-cli/rb-command/>rb</a></li><li><a href=/dcs/api-reference/uplink-cli/rm-command/>rm</a></li><li><a href=/dcs/api-reference/uplink-cli/setup-command/>setup</a></li><li><a href=/dcs/api-reference/uplink-cli/share-command/>share</a></li></ul></li><li><input type=checkbox id=section-03ffd000c84f3189e27b539e51443e62 class=toggle>
<label for=section-03ffd000c84f3189e27b539e51443e62 class="flex justify-between"><a href=/dcs/api-reference/s3-gateway/>Self-hosted S3 Compatible Gateway</a></label><ul><li><a href=/dcs/api-reference/s3-gateway/gateway-st-advanced-usage/>Gateway ST Advanced Usage</a></li></ul></li><li><a href=/dcs/api-reference/linksharing-service/>Linksharing Service</a></li><li><input type=checkbox id=section-0848317479e2fc58b812eefd4912b4a4 class=toggle>
<label for=section-0848317479e2fc58b812eefd4912b4a4 class="flex justify-between"><a href=/dcs/api-reference/storj-client-libraries/>Storj Client Libraries</a></label><ul><li><a href=https://github.com/storj/uplink class=book-external-link target=_blank rel=noopener>Go<img src=/svg/external-link.svg class=book-icon alt="External Link"></a></li><li><a href=https://github.com/storj/uplink-c class=book-external-link target=_blank rel=noopener>C<img src=/svg/external-link.svg class=book-icon alt="External Link"></a></li><li><a href=https://github.com/storj/uplink-android class=book-external-link target=_blank rel=noopener>Android<img src=/svg/external-link.svg class=book-icon alt="External Link"></a></li><li><a href=https://github.com/storj/uplink-java class=book-external-link target=_blank rel=noopener>Java<img src=/svg/external-link.svg class=book-icon alt="External Link"></a></li><li><a href=https://www.npmjs.com/package/uplink-nodejs class=book-external-link target=_blank rel=noopener>NodeJS<img src=/svg/external-link.svg class=book-icon alt="External Link"></a></li></ul></li></ul></li><li class=book-section-flat><span>How To's</span><ul><li><a href=/dcs/how-tos/container-registry-docker/>Container Registry - Docker</a></li><li><input type=checkbox id=section-591e24e11327becce048ce6a5d0b3e18 class=toggle>
<label for=section-591e24e11327becce048ce6a5d0b3e18 class="flex justify-between"><a href=/dcs/how-tos/host-a-static-website/>Host a Static Website</a></label><ul><li><a href=/dcs/how-tos/host-a-static-website/host-a-static-website-with-the-cli-and-linksharing-service/>Host a Static Website with the Uplink CLI and Linksharing Service</a></li></ul></li><li><a href=/dcs/how-tos/configure-tools-for-the-partner-program/>Configure Tools for the Partner Program</a></li><li><a href=/dcs/how-tos/fastly-integration/ class=active>Fastly Integration</a></li><li><a href=https://filebase.com class=book-external-link target=_blank rel=noopener>Configure Filebase for easy upload<img src=/svg/external-link.svg class=book-icon alt="External Link"></a></li><li><a href=/dcs/how-tos/backup-with-duplicati/>Backup With Duplicati</a></li><li><a href=/dcs/how-tos/nft-storage/>NFT storage for OpenSea</a></li><li><input type=checkbox id=section-8fe4791a1117b6b147a551b2324e5838 class=toggle>
<label for=section-8fe4791a1117b6b147a551b2324e5838 class="flex justify-between"><a href=/dcs/how-tos/sync-files-with-rclone/>Sync Files With Rclone</a></label><ul><li><a href=/dcs/how-tos/sync-files-with-rclone/rclone-with-native-integration/>Rclone with Native Integration</a></li><li><a href=/dcs/how-tos/sync-files-with-rclone/rclone-with-hosted-gateway/>Rclone with Hosted Gateway</a></li></ul></li><li><a href=/dcs/how-tos/backup-with-restic/>Backup With Restic</a></li><li><a href=/dcs/how-tos/set-up-filezilla-for-decentralized-file-transfer/>FileZilla Native Integration</a></li><li><a href=/dcs/how-tos/filezilla-pro-integration-guide/>Filezilla Pro Integration Guide</a></li><li><a href=/dcs/how-tos/mongodb-ops-manager-backup/>MongoDB Ops Manager Backup</a></li><li><a href=/dcs/how-tos/tesla-sentry-mode-teslausb/>Store Tesla Sentry Mode & Dashcam videos on Storj DCS</a></li><li><a href=/dcs/how-tos/how-to-connect-s3fs-to-storj-dcs/>How to connect s3fs to Storj DCS</a></li><li><a href=/dcs/how-tos/how-to-set-up-video-analytics-and-video-management-with-kerberos-vault/>How to set up video analytics and video management with Kerberos Vault</a></li><li><a href=/dcs/how-tos/how-to-hod-rod-file-transfer-performance-on-storj-dcs/>How to Hod Rod File Transfer Performance on Storj DCS</a></li><li><a href=/dcs/how-tos/backups-with-hashbackup/>Backups with HashBackup</a></li><li><a href=/dcs/how-tos/how-to-use-plex-and-storj-dcs-as-a-private-streaming-service/>How to use Plex and Storj DCS as a private streaming service</a></li><li><a href=/dcs/how-tos/how-to-use-cyberduck-and-storj-dcs/>How to use Cyberduck and Storj DCS</a></li><li><a href=/dcs/how-tos/storj-ipfs-pinning-service-beta/>Storj IPFS Pinning Service (Beta)</a></li><li><a href=/dcs/how-tos/simplify-file-management-with-s3-browser-and-storj-dcs/>Simplify File Management with S3 Browser and Storj DCS</a></li><li><a href=/dcs/how-tos/kubernetes-backup-via-velero/>Kubernetes Backup via Velero</a></li></ul></li><li class=book-section-flat><span>Solution Architectures</span><ul><li><a href=/dcs/solution-architectures/common-use-cases/>Common Use Cases</a></li><li><a href=/dcs/solution-architectures/common-architectural-patterns/>Common Architectural Patterns</a></li></ul></li><li class=book-section-flat><span>Concepts</span><ul><li><a href=/dcs/concepts/overview/>Understanding Storj DCS</a></li><li><a href=/dcs/concepts/definitions/>Definitions</a></li><li><a href=/dcs/concepts/key-architecture-constructs/>Key Architecture Constructs</a></li><li><input type=checkbox id=section-e3983b48cc8585311f4fd92a3441c885 class=toggle>
<label for=section-e3983b48cc8585311f4fd92a3441c885 class="flex justify-between"><a href=/dcs/concepts/access/>Access Management</a></label><ul><li><input type=checkbox id=section-2aaccce9e50f91dfc9ae1f4f2919e73d class=toggle>
<label for=section-2aaccce9e50f91dfc9ae1f4f2919e73d class="flex justify-between"><a href=/dcs/concepts/access/access-grants/>Access Grants</a></label><ul><li><input type=checkbox id=section-6532f8fab18a0bf2730b54084407ef27 class=toggle>
<label for=section-6532f8fab18a0bf2730b54084407ef27 class="flex justify-between"><a href=/dcs/concepts/access/access-grants/api-key/>API Key</a></label><ul><li><a href=/dcs/concepts/access/access-grants/api-key/restriction/>Access Restrictions</a></li></ul></li><li><a href=/dcs/concepts/access/access-grants/when-to-use-the-satellite-web-interface-and-when-to-use-the-cli/>When to use the Satellite Web Interface and When to use the CLI</a></li></ul></li><li><input type=checkbox id=section-d17166aeaa257fe6cfe34e9469861364 class=toggle>
<label for=section-d17166aeaa257fe6cfe34e9469861364 class="flex justify-between"><a href=/dcs/concepts/access/encryption-and-keys/>Encryption Keys</a></label><ul><li><a href=/dcs/concepts/access/encryption-and-keys/key-management/>Key Management</a></li><li><a href=/dcs/concepts/access/encryption-and-keys/when-to-use-different-encryption-keys/>When to use different encryption keys</a></li></ul></li><li><a href=/dcs/concepts/access/access-revocation/>Access Revocation</a></li><li><a href=/dcs/concepts/access/capability-based-access-control/>Capability Based Access vs Access Control Lists</a></li><li><a href=/dcs/concepts/access/access-management-at-the-edge/>Access Management at the Edge</a></li></ul></li><li><input type=checkbox id=section-32bee2047eb722c84da55e9b4fbd0a7e class=toggle>
<label for=section-32bee2047eb722c84da55e9b4fbd0a7e class="flex justify-between"><a href=/dcs/concepts/edge-services/>Edge Services</a></label><ul><li><a href=/dcs/concepts/edge-services/auth-service/>Auth Service</a></li></ul></li><li><a href=/dcs/concepts/connectors/>Connectors</a></li><li><a href=/dcs/concepts/data-structure/>Data Structure</a></li><li><input type=checkbox id=section-273072f64771f53acb81a101acf9cdb9 class=toggle>
<label for=section-273072f64771f53acb81a101acf9cdb9 class="flex justify-between"><a href=/dcs/concepts/encryption-key/>Encryption</a></label><ul><li><a href=/dcs/concepts/encryption-key/how-encryption-is-implemented/>How Encryption is Implemented</a></li><li><a href=/dcs/concepts/encryption-key/design-decision-end-to-end-encryption/>Design Decision: End-to-end Encryption</a></li><li><a href=/dcs/concepts/encryption-key/design-decision-server-side-encryption/>Design Decision: Server-side Encryption</a></li></ul></li><li><input type=checkbox id=section-390f7f447019f4755db05aad8ca13661 class=toggle>
<label for=section-390f7f447019f4755db05aad8ca13661 class="flex justify-between"><a href=/dcs/concepts/decentralization/>Decentralization</a></label><ul><li><a href=/dcs/concepts/decentralization/coordination-avoidance/>Coordination Avoidance</a></li></ul></li><li><a href=/dcs/concepts/file-redundancy/>File Redundancy</a></li><li><a href=/dcs/concepts/multiregion-availability/>Multiregion Availability</a></li><li><a href=/dcs/concepts/limits/>Usage Limits</a></li><li><a href=/dcs/concepts/satellite/>Satellite (Metadata Region)</a></li><li><a href=/dcs/concepts/s3-compatibility/>S3 Compatibility</a></li><li><a href=/dcs/concepts/file-repair/>File Repair</a></li></ul></li><li class=book-section-flat><span>Support</span><ul><li><a href=/dcs/support/support-process-overview/>Support Overview</a></li><li><a href=/dcs/support/faqs/>FAQ</a></li><li><a href=https://forum.storj.io/c/engineer-amas/dev-category class=book-external-link target=_blank rel=noopener>Community Forum<img src=/svg/external-link.svg class=book-icon alt="External Link"></a></li><li><a href=https://status.tardigrade.io class=book-external-link target=_blank rel=noopener>Status Page<img src=/svg/external-link.svg class=book-icon alt="External Link"></a></li><li><a href=https://support.tardigrade.io class=book-external-link target=_blank rel=noopener>Help Desk<img src=/svg/external-link.svg class=book-icon alt="External Link"></a></li></ul></li><li class=book-section-flat><span>Billing, Payment & Accounts</span><ul><li><input type=checkbox id=section-e86e5160b6cbbb979535071ad9af4793 class=toggle>
<label for=section-e86e5160b6cbbb979535071ad9af4793 class="flex justify-between"><a href=/dcs/billing-payment-and-accounts-1/pricing/>Billing, Payment and Accounts</a></label><ul><li><a href=/dcs/billing-payment-and-accounts-1/pricing/billing-and-payment/>How Billing is Calculated</a></li><li><a href=/dcs/billing-payment-and-accounts-1/pricing/free-tier/>Free Plan</a></li><li><a href=/dcs/billing-payment-and-accounts-1/pricing/usage-limit-increases/>Usage Limit Increases</a></li></ul></li><li><input type=checkbox id=section-4e3c83ea13e2e7ae2025639618d7fec3 class=toggle>
<label for=section-4e3c83ea13e2e7ae2025639618d7fec3 class="flex justify-between"><a href=/dcs/billing-payment-and-accounts-1/storj-token/>Payment Methods</a></label><ul><li><a href=/dcs/billing-payment-and-accounts-1/storj-token/promotional-credits/>Promotional Credits</a></li><li><a href=/dcs/billing-payment-and-accounts-1/storj-token/debits-against-payment-methods/>Debits Against Payment Methods</a></li><li><a href=/dcs/billing-payment-and-accounts-1/storj-token/changing-payment-methods/>Changing Payment Methods</a></li><li><a href=/dcs/billing-payment-and-accounts-1/storj-token/deleting-a-payment-method/>Deleting a Payment Method</a></li><li><a href=/dcs/billing-payment-and-accounts-1/storj-token/expired-credit-card/>Expired Credit Card</a></li><li><a href=/dcs/billing-payment-and-accounts-1/storj-token/reporting-a-payment-problem/>Reporting a Payment Problem</a></li></ul></li><li><a href=/dcs/billing-payment-and-accounts-1/requesting-a-refund/>Requesting a Refund</a></li><li><a href=/dcs/billing-payment-and-accounts-1/closing-an-account/>Closing an Account</a></li><li><a href=/dcs/billing-payment-and-accounts-1/data-retention-policy/>Data Retention Policy</a></li></ul></li><li class=book-section-flat><span>Resources</span><ul><li><a href=https://www.storj.io/storjv3.pdf class=book-external-link target=_blank rel=noopener>Whitepaper<img src=/svg/external-link.svg class=book-icon alt="External Link"></a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Fastly Integration</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><div class=toc-title>Contents</div><nav id=TableOfContents><ul><li><a href=#setting-up-fastly-as-an-edge-server>Setting Up Fastly as an Edge Server</a><ul><li><a href=#verifying-the-service-is-configured>Verifying the service is configured</a></li><li><a href=#advanced-cache-control>Advanced Cache Control</a></li></ul></li><li><a href=#using-a-bucket-for-origin-hosting>Using a bucket for origin hosting</a></li></ul></nav></aside></header><article class=markdown><h1 id=fastly-integration>Fastly Integration
<a class=anchor href=#fastly-integration>#</a></h1><p>Prerequisites</p><p>Before you can connect your buckets to Fastly, you will first need a Fastly account. Once that is set up, follow the instructions below to configure a Fastly service with your buckets as an origin host.</p><h2 id=setting-up-fastly-as-an-edge-server>Setting Up Fastly as an Edge Server
<a class=anchor href=#setting-up-fastly-as-an-edge-server>#</a></h2><p>To make your buckets available through the Fastly edge cloud network, you will configure Storj as your Fastly service&rsquo;s origin server.</p><p>To do that, you must first
<a href=https://docs.fastly.com/en/guides/working-with-services#creating-a-new-service>create a Fastly service</a> using the following values as you go:</p><ul><li>For the new Fastly domain and host, set the <strong>Domain Name</strong> field to the hostname you will be using for your URL. For example, <code>cdn.example.com</code></li><li>When you get to the <strong>Hosts</strong> section on the <strong>Origins</strong> page, enter the address of the
<a href=/dcs/api-reference/s3-compatible-gateway/#regions-and-points-of-presence>Storj gateway endpoint</a> you would like to use for this service. Include the name of your bucket, for example: <code>mybucket.gateway.us1.storjshare.io</code></li><li>After adding the host, click the pencil icon to <strong>Edit this host</strong> and check that the following are correctly filled out:<ul><li><strong>Name</strong>: Any name you would like to use for your Fastly service</li><li><strong>Address</strong>: This should be the address of your gateway endpoint</li></ul></li></ul><p>Additionally, if you have enabled TLS for your gateway and wish to configure that, check the following fields as well:</p><ul><li><strong>Enable TLS</strong>: The default for this is <strong>Yes</strong></li><li><strong>SNI hostname</strong>: Select <strong>Match the SNI hostname to the Certificate hostname</strong>. The gateway address you filled out and double-checked above should automatically appear.</li><li><strong>Certificate hostname</strong>: This should be the same IP address or hostname of your gateway.</li></ul><p>Note that if you are going to use AWS S3 integration, you may want to leave the <strong>Override host</strong> field blank when creating your service. Otherwise, it will override important authentication headers read by AWS (more on that below).</p><h3 id=verifying-the-service-is-configured>Verifying the service is configured
<a class=anchor href=#verifying-the-service-is-configured>#</a></h3><p>Fastly creates a DNS mapping from the domain you entered when creating your service to <code>&lt;domain>.global.prod.fastly.net</code>. So following the above steps, this would be <code>cdn.example.com.global.prod.fastly.net</code>.</p><p>Create an alias in your own DNS settings for the domain name you are using. For example, create a CNAME record mapping <code>cdn.example.com</code> to <code>global-nossl.fastly.net</code></p><p>Fastly caches all content by default for 1 hour. This can be modified by sending a <code>Cache-Control</code> header. If you are unsure whether you are sending any cache control headers, you can verify with a simple cURL command:</p><pre tabindex=0><code>$ curl -I https://cdn.example.com

Accept-Ranges: bytes
Content-Length: 250
Content-Type: application/xml
Server: MinIO/DEVELOPMENT.GOGET
Vary: Origin
Date: Wed, 20 Oct 2020 05:56:29 GMT
</code></pre><p>Since there are no <code>Cache-Control</code> headers in this example, the default cache of 1 hour will be applied.</p><h3 id=advanced-cache-control>Advanced Cache Control
<a class=anchor href=#advanced-cache-control>#</a></h3><p>Fastly also has documentation on how different objects are cached. You can find more information in their
<a href=https://developer.fastly.com/learning/concepts/cache-freshness/>cache freshness docs</a>.</p><h2 id=using-a-bucket-for-origin-hosting>Using a bucket for origin hosting
<a class=anchor href=#using-a-bucket-for-origin-hosting>#</a></h2><p>To integrate your S3 compatible gateway as an origin with Fastly, first
<a href=/dcs/getting-started/quickstart-uplink-cli/uploading-your-first-object/create-first-access-grant/>create an access grant</a>. You will need the <strong>Access key</strong> and <strong>Secret key</strong>, as well as your bucket name.</p><p>Once you have the access grant you will use, enable your Fastly service to support the latest version of
<a href=https://docs.aws.amazon.com/AmazonS3/latest/API/sig-v4-header-based-auth.html>Amazon&rsquo;s header-based authentication</a> by creating a
<a href=https://docs.fastly.com/en/guides/uploading-custom-vcl>custom VCL</a> on Fastly.</p><p>Next create a Fastly
<a href=https://docs.fastly.com/en/guides/about-vcl-snippets>VCL snippet</a>. Select the following options for your snippet:</p><ul><li><strong>Type</strong>: select <strong>within subroutine</strong></li><li>In the dropdown box, select <strong>miss.</strong> Then, paste the following code into the <strong>VCL</strong> box. Update the variables where noted to the values from your access grant, bucket name, and bucket gateway:</li></ul><pre tabindex=0><code>declare local var.accessKey STRING;
declare local var.secretKey STRING;
declare local var.storjBucket STRING;
declare local var.storjGateway STRING;
declare local var.region STRING;
declare local var.canonicalHeaders STRING;
declare local var.signedHeaders STRING;
declare local var.canonicalRequest STRING;
declare local var.canonicalQuery STRING;
declare local var.stringToSign STRING;
declare local var.dateStamp STRING;
declare local var.signature STRING;
declare local var.scope STRING;


set var.accessKey = &#34;YOUR_ACCESS_KEY&#34;;   # Change this value to your own data
set var.secretKey = &#34;YOUR_SECRET_KEY&#34;;   # Change this value to your own data
set var.storjBucket = &#34;YOUR_BUCKET_NAME&#34;;   # Change this value to your own data
set var.storjGateway = &#34;STORJ-DCS_GATEWAY&#34;;   # Change this value to your own data
set var.region = &#34;decentralized&#34;;


if (req.method == &#34;GET&#34; &amp;&amp; !req.backend.is_shield) {

  set bereq.http.x-amz-content-sha256 = digest.hash_sha256(&#34;&#34;);
  set bereq.http.x-amz-date = strftime({&#34;%Y%m%dT%H%M%SZ&#34;}, now);
  set bereq.http.host = var.storjBucket &#34;.&#34; var.storjGateway;
  set bereq.url = querystring.remove(bereq.url);
  set bereq.url = regsuball(urlencode(urldecode(bereq.url.path)), {&#34;%2F&#34;}, &#34;/&#34;);
  set var.dateStamp = strftime({&#34;%Y%m%d&#34;}, now);
  set var.canonicalHeaders = &#34;&#34;
	&#34;host:&#34; bereq.http.host LF
	&#34;x-amz-content-sha256:&#34; bereq.http.x-amz-content-sha256 LF
	&#34;x-amz-date:&#34; bereq.http.x-amz-date LF
  ;
  set var.canonicalQuery = &#34;&#34;;
  set var.signedHeaders = &#34;host;x-amz-content-sha256;x-amz-date&#34;;
  set var.canonicalRequest = &#34;&#34;
	&#34;GET&#34; LF
	bereq.url.path LF
	var.canonicalQuery LF
	var.canonicalHeaders LF
	var.signedHeaders LF
	digest.hash_sha256(&#34;&#34;)
  ;

  set var.scope = var.dateStamp &#34;/&#34; var.region &#34;/s3/aws4_request&#34;;


  set var.stringToSign = &#34;&#34;
	&#34;AWS4-HMAC-SHA256&#34; LF
	bereq.http.x-amz-date LF
	var.scope LF
	regsub(digest.hash_sha256(var.canonicalRequest),&#34;^0x&#34;, &#34;&#34;)
  ;

  set var.signature = digest.awsv4_hmac(
	var.secretKey,
	var.dateStamp,
	var.region,
	&#34;s3&#34;,
	var.stringToSign
  );


 set bereq.http.Authorization = &#34;AWS4-HMAC-SHA256 &#34;
	&#34;Credential=&#34; var.accessKey &#34;/&#34; var.scope &#34;, &#34;
	&#34;SignedHeaders=&#34; var.signedHeaders &#34;, &#34;
	&#34;Signature=&#34; + regsub(var.signature,&#34;^0x&#34;, &#34;&#34;)
  ;

  unset bereq.http.Accept;
  unset bereq.http.Accept-Language;
  unset bereq.http.User-Agent;
  unset bereq.http.Fastly-Client-IP;
}
</code></pre><p>Note that, as mentioned above, if you have an <strong>override host</strong> specified in your Fastly service settings, that value will cause the <code>http.host</code> header to be overwritten which could be invalid for AWS authentication.</p><p>See also
<a href=https://docs.fastly.com/en/guides/storj-dcs-object-storage>Storj DCS Object Storage on Fastly</a>.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(n){const e=window.getSelection(),t=document.createRange();t.selectNodeContents(n),e.removeAllRanges(),e.addRange(t)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><div class=toc-title>Contents</div><nav id=TableOfContents><ul><li><a href=#setting-up-fastly-as-an-edge-server>Setting Up Fastly as an Edge Server</a><ul><li><a href=#verifying-the-service-is-configured>Verifying the service is configured</a></li><li><a href=#advanced-cache-control>Advanced Cache Control</a></li></ul></li><li><a href=#using-a-bucket-for-origin-hosting>Using a bucket for origin hosting</a></li></ul></nav></div></aside></main></body></html>